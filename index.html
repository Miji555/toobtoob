<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Block Choice</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  background: #ffffff;
  color: #111827;
  font-family: system-ui, sans-serif;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background 0.3s ease;
}

/* shake + danger */
body.shake {
  animation: shake 0.35s;
  background: #fee2e2;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  50% { transform: translateX(6px); }
  75% { transform: translateX(-6px); }
  100% { transform: translateX(0); }
}

.screen {
  display: none;
  width: 100%;
  max-width: 420px;
  padding: 16px;
}
.active { display: block; }

.topbar {
  position: relative;
  height: 40px;
  margin-bottom: 20px;
}

.left-info {
  position: absolute;
  left: 0;
  top: 0;
  font-size: 14px;
}

.center-time {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: 0;
  font-size: 18px;
  font-weight: 600;
}

.right-btn {
  position: absolute;
  right: 0;
  top: 0;
}

button {
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
}

.pause-btn {
  padding: 6px 12px;
  background: #e5e7eb;
}

.primary {
  padding: 14px 24px;
  background: #2563eb;
  color: white;
}

.question {
  font-size: 40px;
  margin: 30px 0;
  text-align: center;
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 24px;
}

.choice {
  width: 130px;
  height: 80px;
  font-size: 28px;
  border-radius: 14px;
  color: white;
}

.left { background: #f59e0b; }
.right { background: #2dd4bf; }

.correct { background: #22c55e !important; }
.wrong { background: #ef4444 !important; }

.center {
  text-align: center;
}

.big {
  font-size: 72px;
  font-weight: 800;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu" class="screen active center">
  <h1>Math Block Choice</h1>
  <p>High Score: <span id="highScore">0</span></p>
  <button class="primary" onclick="prepareGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
</div>

<!-- COUNTDOWN -->
<div id="countdown" class="screen center">
  <div class="big" id="countNum">3</div>
  <p>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°</p>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="topbar">
    <div class="left-info">
      ‚ù§Ô∏è <span id="hearts">3</span> | üèÜ <span id="score">0</span>
    </div>
    <div class="center-time">
      ‚è± <span id="time">10</span>
    </div>
    <div class="right-btn">
      <button class="pause-btn" onclick="pauseGame()">‡∏´‡∏¢‡∏∏‡∏î</button>
    </div>
  </div>

  <div class="question" id="question"></div>

  <div class="buttons">
    <button id="leftBtn" class="choice left" onclick="choose('left')"></button>
    <button id="rightBtn" class="choice right" onclick="choose('right')"></button>
  </div>
</div>

<!-- PAUSE -->
<div id="pause" class="screen center">
  <h2>‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Å‡∏°</h2>
  <button class="primary" onclick="resumeGame()">‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠</button>
  <br><br>
  <button class="pause-btn" onclick="goMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
</div>

<!-- GAME OVER -->
<div id="over" class="screen center">
  <div class="big">GAME OVER</div>
  <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="finalScore"></span></p>
  <p>High Score: <span id="finalHigh"></span></p>
  <button class="primary" onclick="goMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
</div>

<script>
let score, hearts, time, timer;
let correctSide, paused=false, streak=0;

const colors = ["#fef3c7","#dbeafe","#dcfce7","#fae8ff","#ffe4e6"];
const $ = id => document.getElementById(id);

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
}

/* countdown */
function prepareGame(){
  show('countdown');
  let n=3;
  countNum.textContent=n;
  const cd=setInterval(()=>{
    n--;
    if(n===0){ clearInterval(cd); startGame(); }
    else countNum.textContent=n;
  },1000);
}

function startGame(){
  score=0; hearts=3; streak=0;
  paused=false;
  document.body.style.background="#ffffff";
  updateUI();
  show('game');
  newQuestion();
}

function updateUI(){
  $('score').textContent=score;
  $('hearts').textContent=hearts;
}

/* timer */
function startTimer(){
  clearInterval(timer);
  time=10;
  $('time').textContent=time;
  timer=setInterval(()=>{
    if(!paused){
      time--;
      $('time').textContent=time;
      if(time<=0) danger();
    }
  },1000);
}

function danger(){
  clearInterval(timer);
  screenShake();
  hearts--;
  streak=0;
  document.body.style.background="#ffffff";
  if(hearts<=0) endGame();
  else newQuestion();
}

function screenShake(){
  document.body.classList.add('shake');
  setTimeout(()=>document.body.classList.remove('shake'),350);
}

function newQuestion(){
  if(streak>=5){
    document.body.style.background=colors[Math.floor(Math.random()*colors.length)];
  }

  const a=Math.floor(Math.random()*9)+1;
  const b=Math.floor(Math.random()*9)+1;
  const ans=a*b;
  $('question').textContent=`${a} √ó ${b}`;
  const wrong=ans+Math.floor(Math.random()*5)+1;

  if(Math.random()<0.5){
    correctSide='left';
    leftBtn.textContent=ans;
    rightBtn.textContent=wrong;
  }else{
    correctSide='right';
    leftBtn.textContent=wrong;
    rightBtn.textContent=ans;
  }
  startTimer();
}

function choose(side){
  if(paused) return;
  const btn=side==='left'?leftBtn:rightBtn;

  if(side===correctSide){
    btn.classList.add('correct');
    score++; streak++;
    setTimeout(()=>btn.classList.remove('correct'),200);
    updateUI();
    newQuestion();
  }else{
    btn.classList.add('wrong');
    setTimeout(()=>btn.classList.remove('wrong'),200);
    screenShake();
    hearts--; streak=0;
    document.body.style.background="#ffffff";
    updateUI();
    if(hearts<=0) endGame();
    else newQuestion();
  }
}

/* pause */
function pauseGame(){ paused=true; show('pause'); }
function resumeGame(){ paused=false; show('game'); }

/* game over */
function endGame(){
  clearInterval(timer);
  $('finalScore').textContent=score;
  let hs=localStorage.getItem("mathHigh")||0;
  if(score>hs){ hs=score; localStorage.setItem("mathHigh",hs); }
  $('finalHigh').textContent=hs;
  show('over');
}

function goMenu(){
  clearInterval(timer);
  paused=false;
  $('highScore').textContent=localStorage.getItem("mathHigh")||0;
  show('menu');
}

$('highScore').textContent=localStorage.getItem("mathHigh")||0;
</script>

</body>
</html>
