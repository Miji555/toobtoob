<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Block Choice</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,sans-serif;
  background:#f9fafb;
  height:100vh;
  overflow:hidden;
  transition:background .3s;
}
body.danger{
  background:#fee2e2;
  animation:shake .35s;
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
  100%{transform:translateX(0)}
}

.screen{display:none;height:100vh}
.active{display:flex;flex-direction:column;align-items:center;justify-content:center}

/* HUD */
.hud{
  position:fixed;
  top:0;left:0;
  width:100%;
  padding:10px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  z-index:10;
  background:#ffffffcc;
  backdrop-filter:blur(6px);
}
.hud-left{font-size:14px}
.hud-center{font-size:18px;font-weight:700}
.hud-right button{
  border:none;
  background:#e5e7eb;
  padding:6px 12px;
  border-radius:10px;
}

/* Game */
.game{
  padding-top:70px;
  width:100%;
  max-width:420px;
  text-align:center;
}
.question{
  font-size:40px;
  margin:30px 0;
}
.choices{
  display:flex;
  gap:20px;
  justify-content:center;
}
.choice{
  width:140px;
  height:80px;
  font-size:28px;
  color:white;
  border:none;
  border-radius:16px;
  transition:transform .15s;
}
.choice:active{transform:scale(.9)}
.left{background:#f59e0b}
.right{background:#2dd4bf}
.correct{background:#22c55e!important}
.wrong{background:#ef4444!important}

/* Menu / Pause / Over */
button.primary{
  background:#2563eb;
  color:white;
  border:none;
  padding:14px 28px;
  border-radius:14px;
  font-size:18px;
}
.big{font-size:64px;font-weight:800}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu" class="screen active">
  <h1>Math Block Choice</h1>
  <p>High Score: <span id="high">0</span></p>
  <br>
  <button class="primary" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="hud">
    <div class="hud-left">
      ‚ù§Ô∏è <span id="heart">3</span> |
      üèÜ <span id="score">0</span>
    </div>
    <div class="hud-center">‚è± <span id="time">10</span></div>
    <div class="hud-right">
      <button onclick="pauseGame()">‡∏´‡∏¢‡∏∏‡∏î</button>
    </div>
  </div>

  <div class="game">
    <div class="question" id="question"></div>
    <div class="choices">
      <button id="a" class="choice left" onclick="choose(0)"></button>
      <button id="b" class="choice right" onclick="choose(1)"></button>
    </div>
  </div>
</div>

<!-- PAUSE -->
<div id="pause" class="screen">
  <h2>‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Å‡∏°</h2>
  <br>
  <button class="primary" onclick="resumeGame()">‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠</button>
</div>

<!-- GAME OVER -->
<div id="over" class="screen">
  <div class="big">GAME OVER</div>
  <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="final"></span></p>
  <button class="primary" onclick="backMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
</div>

<script>
let score,heart,time,timer,paused=false;
let correctIndex;
const ops=["+","-","√ó","√∑"];

const soundCorrect=new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const soundWrong=new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startGame(){
  score=0;heart=3;
  show("game");
  updateUI();
  nextQuestion();
}

function difficulty(){
  if(score<5) return 1;
  if(score<15) return 2;
  return 3;
}

function nextQuestion(){
  clearInterval(timer);
  time=10;
  document.getElementById("time").textContent=time;

  const lvl=difficulty();
  const op=ops[Math.floor(Math.random()*(lvl+1))];
  let a=Math.floor(Math.random()*9*lvl)+1;
  let b=Math.floor(Math.random()*9*lvl)+1;
  let ans;

  if(op==="√∑"){ ans=a; a=a*b; }
  else if(op==="+") ans=a+b;
  else if(op==="-") ans=a-b;
  else ans=a*b;

  document.getElementById("question").textContent=`${a} ${op} ${b}`;
  const wrong=ans+Math.floor(Math.random()*5)+1;
  correctIndex=Math.random()<0.5?0:1;
  document.getElementById("a").textContent=correctIndex===0?ans:wrong;
  document.getElementById("b").textContent=correctIndex===1?ans:wrong;

  timer=setInterval(()=>{
    if(!paused){
      time--;
      document.getElementById("time").textContent=time;
      if(time<=0) fail();
    }
  },1000);
}

function choose(i){
  if(paused) return;
  const btn=i===0?document.getElementById("a"):document.getElementById("b");
  if(i===correctIndex){
    soundCorrect.play();
    btn.classList.add("correct");
    score++;
    setTimeout(()=>btn.classList.remove("correct"),200);
    updateUI();
    nextQuestion();
  }else fail();
}

function fail(){
  clearInterval(timer);
  soundWrong.play();
  navigator.vibrate?.(200);
  document.body.classList.add("danger");
  setTimeout(()=>document.body.classList.remove("danger"),400);
  heart--;
  updateUI();
  if(heart<=0) endGame();
  else nextQuestion();
}

function updateUI(){
  heartEl.textContent=heart;
  scoreEl.textContent=score;
}

function pauseGame(){ paused=true; show("pause"); }
function resumeGame(){ paused=false; show("game"); }

function endGame(){
  show("over");
  final.textContent=score;
  let h=localStorage.getItem("high")||0;
  if(score>h) localStorage.setItem("high",score);
}

function backMenu(){
  high.textContent=localStorage.getItem("high")||0;
  show("menu");
}

const heartEl=document.getElementById("heart");
const scoreEl=document.getElementById("score");
const final=document.getElementById("final");
const high=document.getElementById("high");
high.textContent=localStorage.getItem("high")||0;
</script>
</body>
</html>
