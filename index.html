<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<title>Math Combo Game</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, sans-serif;
  background: linear-gradient(180deg,#020617,#0f172a);
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
}

.screen {
  display: none;
  width: 100%;
  max-width: 420px;
  padding: 20px;
}
.active { display: block; }

h1,h2 { text-align: center; }

button {
  width: 100%;
  padding: 16px;
  font-size: 20px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
}

.choice {
  background: #2563eb;
  color: white;
  font-size: 28px;
}

.correct { background: #22c55e !important; }
.wrong { background: #ef4444 !important; }

.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
}

.hearts { color: #ef4444; }
.boss { color: #f97316; }

.question {
  font-size: 32px;
  margin: 30px 0;
  text-align: center;
}

.stack { display: flex; flex-direction: column; gap: 14px; }

.small { font-size: 14px; opacity: .8; text-align: center; }
</style>
</head>
<body>

<!-- MENU -->
<div id="menu" class="screen active">
  <h1>Math Combo Game</h1>
  <p class="small">High Score: <span id="highScore">0</span></p>
  <button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
  <button onclick="toggleSound()">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: <span id="soundState">ON</span></button>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="top">
    <div>‚è± <span id="time">10</span></div>
    <div>Lv.<span id="level">1</span></div>
    <div class="hearts" id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  </div>

  <div class="top">
    <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô <span id="score">0</span></div>
    <div>üî• x<span id="combo">0</span></div>
  </div>

  <div id="bossBar" class="boss small"></div>

  <div class="question" id="question"></div>

  <div class="stack">
    <button id="leftBtn" class="choice" onclick="choose('left')"></button>
    <button id="rightBtn" class="choice" onclick="choose('right')"></button>
    <button onclick="pauseGame()">‡∏´‡∏¢‡∏∏‡∏î</button>
  </div>
</div>

<!-- GAME OVER -->
<div id="over" class="screen">
  <h2>‡πÄ‡∏Å‡∏°‡∏à‡∏ö</h2>
  <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="finalScore"></span></p>
  <p>High Score: <span id="finalHigh"></span></p>
  <button onclick="goMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
</div>

<script>
/* ===== SOUND ===== */
const sndCorrect = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3");
const sndWrong   = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");
const sndBoss    = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-bonus-alert-767.mp3");
let soundOn = true;

/* ===== STATE ===== */
let score, combo, level, hearts, time, timer;
let correctSide, paused=false;
let bossHP = 0;

/* ===== UI ===== */
const $ = id => document.getElementById(id);
function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
}

/* ===== GAME ===== */
function startGame(){
  score=0; combo=0; level=1; hearts=3;
  show('game');
  newQuestion();
  updateUI();
}

function updateUI(){
  scoreEl.textContent=score;
  comboEl.textContent=combo;
  levelEl.textContent=level;
  heartsEl.textContent="‚ù§Ô∏è".repeat(hearts);
}

function startTimer(limit){
  clearInterval(timer);
  time=limit;
  timeEl.textContent=time;
  timer=setInterval(()=>{
    if(!paused){
      time--;
      timeEl.textContent=time;
      if(time<=0) loseLife();
    }
  },1000);
}

function randomQuestion(){
  let max=10+level*5;
  let ops=["+","-"];
  if(level>=2) ops.push("√ó");
  if(level>=4) ops.push("√∑");

  let op=ops[Math.floor(Math.random()*ops.length)];
  let a=Math.floor(Math.random()*max)+1;
  let b=Math.floor(Math.random()*max)+1;
  let ans;

  if(op==="+") ans=a+b;
  if(op==="-") ans=a-b;
  if(op==="√ó") ans=a*b;
  if(op==="√∑"){ ans=Math.floor(Math.random()*max)+1; b=Math.floor(Math.random()*max)+1; a=ans*b; }

  return {text:`${a} ${op} ${b} = ?`,answer:ans};
}

function newQuestion(){
  const bossFight = level%5===0;
  if(bossFight && bossHP===0){
    bossHP=5;
    sndBoss.play();
  }

  bossBar.textContent = bossFight ? `üßü‚Äç‚ôÇÔ∏è ‡∏ö‡∏≠‡∏™ HP: ${bossHP}` : "";

  const q=randomQuestion();
  question.textContent=q.text;
  const wrong=q.answer+Math.floor(Math.random()*level+1);

  if(Math.random()<0.5){
    correctSide='left';
    leftBtn.textContent=q.answer;
    rightBtn.textContent=wrong;
  }else{
    correctSide='right';
    leftBtn.textContent=wrong;
    rightBtn.textContent=q.answer;
  }

  startTimer(bossFight?5:10);
}

function choose(side){
  if(paused) return;
  const btn=side==='left'?leftBtn:rightBtn;

  if(side===correctSide){
    btn.classList.add('correct');
    if(soundOn) sndCorrect.play();
    score+=10; combo++;

    if(level%5===0){
      bossHP--;
      if(bossHP<=0){ level++; bossHP=0; }
    }else if(combo%5===0){ level++; }

    setTimeout(()=>btn.classList.remove('correct'),200);
    newQuestion();
  }else{
    btn.classList.add('wrong');
    if(soundOn) sndWrong.play();
    setTimeout(()=>btn.classList.remove('wrong'),200);
    loseLife();
  }
  updateUI();
}

function loseLife(){
  hearts--; combo=0;
  if(hearts<=0) endGame();
  else newQuestion();
}

function endGame(){
  clearInterval(timer);
  finalScore.textContent=score;
  let hs=localStorage.getItem("mathHigh")||0;
  if(score>hs){ hs=score; localStorage.setItem("mathHigh",hs); }
  finalHigh.textContent=hs;
  show('over');
}

function toggleSound(){
  soundOn=!soundOn;
  soundState.textContent=soundOn?"ON":"OFF";
}

function goMenu(){
  highScore.textContent=localStorage.getItem("mathHigh")||0;
  show('menu');
}

/* refs */
const timeEl=$("time"),scoreEl=$("score"),comboEl=$("combo"),
levelEl=$("level"),heartsEl=$("hearts"),question=$("question"),
leftBtn=$("leftBtn"),rightBtn=$("rightBtn"),bossBar=$("bossBar");

highScore.textContent=localStorage.getItem("mathHigh")||0;
</script>

</body>
</html>
